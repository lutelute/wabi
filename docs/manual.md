# 侘び（wabi）ユーザーマニュアル

> ルーティンを静かに積み重ねる。自分の体力と心を見つめるアプリ。

---

## 目次

1. [はじめに](#はじめに)
2. [インストール](#インストール)
3. [ルーティンの作成](#ルーティンの作成)
4. [日々の実行](#日々の実行)
5. [体力ゲージ](#体力ゲージ)
6. [チェックイン](#チェックイン)
7. [枯山水](#枯山水)
8. [デイリーノート](#デイリーノート)
9. [サイドバー](#サイドバー)
10. [リマインダー](#リマインダー)
11. [設定](#設定)
12. [クラウド同期](#クラウド同期)
13. [Obsidian連携](#obsidian連携)
14. [バックアップ](#バックアップ)
15. [キーボードショートカット](#キーボードショートカット)

---

## はじめに

侘び（wabi）は、日々のルーティンを管理し、体力と心の状態を記録するアプリです。

タスク管理ツールとは異なり、「どれだけやったか」ではなく「どう過ごしたか」に焦点を当てています。チェックインで体力・心の状態を記録し、枯山水のアニメーションが静かに進捗を映し出します。

### 主な特徴

- テキストベースのルーティン定義（Markdown風の簡単な記法）
- 体力ゲージによるエネルギー管理
- 体力・心・気分のチェックイン記録
- 枯山水アニメーションによる視覚的フィードバック
- クラウド同期（PC・スマートフォン間でデータ共有）
- Obsidianのデイリーノートへの自動エクスポート

---

## インストール

### macOS（デスクトップアプリ）

1. [GitHub Releases](https://github.com/lutelute/wabi/releases/latest) からDMGファイルをダウンロード
2. DMGを開き、`wabi.app` を `アプリケーション` フォルダにドラッグ
3. 初回起動時に「開発元が未確認」と表示される場合は、`システム設定 > プライバシーとセキュリティ` から許可してください

### iPhone / iPad（PWA）

1. Safariで https://lutelute.github.io/wabi/ にアクセス
2. 共有ボタン（↑）をタップ
3. 「ホーム画面に追加」を選択
4. ホーム画面からアプリとして起動できます

### Web ブラウザ

https://lutelute.github.io/wabi/ にアクセスするだけで利用できます。

---

## ルーティンの作成

### モード切替

画面上部の「編集 / 実行」トグルで切り替えます。

- **実行モード**: ルーティンを日々こなす画面
- **編集モード**: ルーティンのテキストを編集する画面

### テキスト記法

ルーティンはMarkdown風のテキストで定義します。

```
## 朝の立ち上がり
- 06:00 ストレッチ 10min
- 静かに座る 10min @mental
- 冷水で顔を洗う 2min *3

## 仕事
- 09:00 集中タイム 60min
- メール確認 15min

## 夕方
- 18:00 散歩 30min
- 振り返り 10min @mental
```

#### 記法の詳細

| 要素 | 書き方 | 例 | 説明 |
|------|--------|-----|------|
| フェーズ | `## タイトル` | `## 朝の立ち上がり` | 項目をグループ分けする見出し |
| 項目 | `- タイトル` | `- ストレッチ` | ルーティンの1項目 |
| 時刻 | `HH:MM` | `- 06:00 ストレッチ` | 項目の開始時刻（任意） |
| 所要時間 | `Nmin` `Nh` | `- 読書 30min` | タイマー付きの所要時間（任意） |
| 心の項目 | `@mental` | `- 瞑想 @mental` | 完了時に振り返りを記録する項目 |
| 重み | `*N` | `- 運動 *3` | 体力ゲージへの影響度 1〜5（任意、デフォルト1） |

**所要時間の書き方**: `10min`, `10m`, `10分`, `1h`, `1時間` が使えます。

### 複数ルーティンの管理

サイドバーからルーティンを追加・切替できます。

- `+` ボタンで新規作成
- ルーティン名をダブルクリックでリネーム
- ホバー時の `×` で削除（最低1つは残ります）

---

## 日々の実行

実行モードでは、今日のルーティンを1つずつ進めていきます。

### チェックの仕方

- **通常の項目**: チェックボックスをクリックで完了
- **タイマー付き項目**: クリックするとタイマーが開始。終了後に自動完了
  - タイマー中は残り時間（MM:SS）と進捗バーが表示されます
  - 「完了」で早期終了、「中止」でキャンセル、「skip」でタイマーなしで完了
- **@mental 項目**: 長押し（1.5秒）で完了。振り返りダイアログが開きます

### 振り返りダイアログ（@mental）

`@mental` タグの項目を完了すると「やってみてどうだった？」というダイアログが開きます。感想を自由に記入して「記録する」を押してください。

### 完了後の気分記録

項目を完了すると、その下に気分ボタンが表示されます。

| ボタン | 意味 |
|--------|------|
| 重い | 身体的・精神的に重く感じた |
| もやもや | すっきりしない、モヤモヤした |
| ふつう | 特に何も感じない |
| 穏やか | 落ち着いた良い状態 |
| 軽い | 心身ともに軽やかに感じた |

この記録はカレンダーやデイリーノートに反映されます。

### 重みの調整

「重み」ボタンを押すと、各項目の横にスライダーが表示されます。体力ゲージへの影響度を調整できます。値が大きいほど、その項目の完了が体力ゲージに大きく反映されます。

### 今フォーカス

画面上部には、現在の時刻と次にやるべき項目が表示されます。すべて完了すると「すべて完了」と表示されます。

---

## 体力ゲージ

体力ゲージは、ルーティンの消化状況をエネルギーとして可視化します。

### 仕組み

- **容量（capacity）**: すべての項目の重みの合計
- **獲得エネルギー（energy）**: 完了した項目の重みの合計
- **残り体力（stamina）**: 容量 − 獲得エネルギー

### ゲージの読み方

- **メインバー**: 残り体力を表示。右端（満タン）から左に減っていきます
  - 緑色: 余裕がある（50%以上）
  - 黄色: やや疲れてきた（20〜50%）
  - 赤色: かなり消耗している（20%未満）
- **獲得バー**: 下の小さいバーは、全体に対する進捗率を表示

### ソフトキャップ

設定したソフトキャップ（デフォルト90%）に到達すると「よくやった」のメッセージが表示されます。100%を目指さなくても、十分やったと認めてくれる仕組みです。

---

## チェックイン

チェックインは、その時点での体力と心の状態を記録する機能です。1日に何回でも記録できます。

### チェックインの手順

1. **体力バー**をクリックして、現在の体力レベル（0〜100）を設定
2. **心バー**をクリックして、心の状態（0〜100）を設定
3. **気分**のボタンをタップして今の気分を記録（任意）
4. **気持ちタグ**から当てはまるものを選択（複数可、任意）
5. **ひとこと**にメモを入力（任意）
6. 「記録する」をタップ

### 気持ちタグ

以下の12種類から選べます：

> 疲れた / すっきり / 不安 / 焦り / 充実 / 眠い / 集中できた / 散漫 / イライラ / リラックス / 達成感 / 無気力

### 気分の変化フィードバック

複数回気分を記録すると、変化に応じてメッセージが表示されます：

- 「心がだいぶ軽くなった」（2段階以上改善）
- 「少し軽くなった」（1段階改善）
- 「疲れてる。休んでいい。」（2段階以上低下）
- 「少し重くなったかも」（1段階低下）

### 推移グラフ

2回以上チェックインすると、体力と心の推移グラフが表示されます。時間軸に沿った変化を視覚的に確認できます。

### 記録のコピー

「全記録をコピー」ボタンで、今日のすべてのチェックイン記録をMarkdown形式でクリップボードにコピーできます。AIチャットに貼り付けて分析してもらうなどの使い方ができます。

---

## 枯山水

枯山水（かれさんすい）は、ルーティンの進捗を禅庭園のアニメーションで表現する機能です。

### 3つの石

| 石 | 位置 | 意味 |
|----|------|------|
| 今日 | 左（大） | 今日の達成率 |
| 今週 | 右上（中） | 今週の平均達成率 |
| 今月 | 右下（中） | 今月の平均達成率 |

### アニメーション

- **砂紋（同心円）**: 達成率が上がると、乱れた波紋が整った同心円に変化します
- **砂粒（パーティクル）**: 散らばっていた砂粒が、波紋に沿って整列していきます
- **石の呼吸**: 完全に整うと、石がゆっくり呼吸するように脈動します

何も操作しなくても、ルーティンを進めるだけで庭園が自然に整っていきます。

### カスタマイズ（設定 > 枯山水）

- **砂粒の密度**: 少 / 標準 / 多
- **砂紋リング数**: 3〜15本（デフォルト10）

---

## デイリーノート

画面下部のテキストエリアに、その日の気づきや手放したことを自由に書けます。

### 自動サマリー

デイリーノートの上部には、その日の記録が自動で要約されます：

- 体力の推移
- 心の推移
- 気分の流れ
- チェックイン回数
- タスク達成率

### エクスポート

- **プレビュー**: YAML frontmatter付きの完成形を確認
- **Obsidian形式でコピー**: クリップボードにコピー。Obsidianのデイリーノートに貼り付けられます

---

## サイドバー

デスクトップでは常時表示、モバイルではハンバーガーメニュー（三本線）から開きます。

### ルーティン一覧

- 作成済みルーティンの一覧
- クリックで切替
- ダブルクリックでリネーム

### 概念ルーティン（ひとこと）

時間帯に応じた穏やかな提案が表示されます。例：

- 朝: 「窓を開けて深呼吸」「白湯を一杯」
- 昼: 「目を閉じて3回深呼吸」
- 夜: 「今日のよかったことを1つ思い出す」

`+` ボタンで自分のひとことを追加することもできます。`×` でその日の提案を非表示にできます。

設定 > ガイド > 概念ルーティン でオン/オフを切り替えられます。

### 月間カレンダー

コンパクトなカレンダーが表示されます。

- **背景色**: 緑のグラデーションで達成率を表現（濃い = 高達成）
- **ボーダー色**: その日の支配的な気分を色で表現
- **ドット**: チェックイン回数（最大3つ）

日付をクリックすると、その日の詳細（達成項目数、チェックイン数、気分の流れなど）がポップアップ表示されます。

---

## リマインダー

画面上部のリマインダーバーに、設定した時刻の通知が表示されます。

### 追加方法

1. リマインダーバーの「＋ リマインダー追加」をタップ
2. 件名と時刻を入力
3. 「追加」をタップ

### 操作

- **OK**: 通知を確認して非表示にする
- **15分後**: 15分後にもう一度通知する（スヌーズ）

---

## 設定

デスクトップアプリでは `Cmd + ,`、モバイルでは画面右上の歯車アイコンから開きます。

### タイマー

| 項目 | 説明 |
|------|------|
| 完了時に通知 | タイマー終了時にシステム通知を表示 |

### 体力

| 項目 | 説明 |
|------|------|
| ソフトキャップ | 「よくやった」が表示される閾値（50〜100%、デフォルト90%） |
| 重みの範囲 | スライダーの最大値（1-5 または 1-10） |
| デフォルトの重み | 新規項目の初期ウェイト |

### 枯山水

| 項目 | 説明 |
|------|------|
| 砂粒の密度 | アニメーションの粒子数（少/標準/多） |
| 砂紋リング数 | 同心円の本数（3〜15） |

### ガイド

| 項目 | 説明 |
|------|------|
| 概念ルーティン | 時間帯に応じた提案の表示 |
| リマインダー音 | リマインダー発火時のサウンド通知 |

### データ

| 項目 | 説明 |
|------|------|
| 実行履歴をすべてクリア | 今日・今週・今月の進捗データをリセット（ルーティン定義は保持） |

---

## クラウド同期

アカウントを作成すると、デスクトップとスマートフォンの間でデータが自動同期されます。

### ログイン

1. 設定 > アカウント を開く
2. メールアドレスとパスワードを入力
3. 「ログイン」をタップ

Web版（PWA）では初回アクセス時にログイン画面が表示されます。パスワード方式またはメール認証コード（OTP）方式を選べます。

### 同期の仕組み

- データは保存のたびに自動でクラウドにプッシュされます（5秒のデバウンス）
- アプリ起動時にクラウドから最新データをプルします
- オフライン時の変更は、オンライン復帰時に自動で同期されます

### ログアウト

設定 > アカウント > 「ログアウト」をタップ。ログアウト後はローカルデータのみで動作します。

---

## Obsidian連携

（デスクトップアプリのみ）

Obsidianのデイリーノートフォルダを指定すると、ルーティンの記録が自動でYAML frontmatterとして書き出されます。

### 設定方法

1. 設定 > Obsidian連携 を開く
2. 「フォルダ選択」でObsidianのデイリーノートフォルダを指定
3. 設定完了。以降はデータ保存時に自動で書き出されます

### 書き出し内容

`YYYY-MM-DD.md` ファイルのYAML frontmatterに以下が書き込まれます：

```yaml
wabi:
  routine: "朝のルーティン"
  completion: "15/18"
  completion_pct: 83
  stamina: [80, 70, 65]
  mental: [75, 80, 72]
  moods: [calm, light]
  items:
    - title: ストレッチ
      done: true
    - title: 読書
      done: false
```

既存のfrontmatterやノート本文は保持されます。`wabi:` ブロックのみが更新されます。

### 手動エクスポート

「今すぐ書き出し」ボタンで即座にエクスポートすることもできます。

---

## バックアップ

### エクスポート

設定 > バックアップ > 「エクスポート」で、全データ（ルーティン定義、実行履歴、設定）をJSONファイルとして保存できます。

### インポート

設定 > バックアップ > 「インポート」で、エクスポートしたJSONファイルからデータを復元できます。現在のデータは上書きされます（確認ダイアログあり）。

### 自動バックアップ

データは保存のたびに自動で1世代前のバックアップが保持されます。データが破損した場合は、次回起動時に自動で復元されます。

---

## キーボードショートカット

| ショートカット | 動作 |
|----------------|------|
| `Cmd + ,` | 設定を開く（デスクトップアプリ） |
| `Escape` | ダイアログ・設定を閉じる |

---

## 技術情報

- **バージョン**: v1.0.0
- **対応プラットフォーム**: macOS (Apple Silicon), Web (Chrome, Safari, Firefox), iPhone/iPad (PWA)
- **データ保存先**: デスクトップアプリはローカルファイル、Web版はブラウザのlocalStorage
- **クラウド**: Supabase（PostgreSQL + RLS）
- **ソースコード**: https://github.com/lutelute/wabi
